{% extends "layout.html" %}

{% block content %}
<h1>‚öôÔ∏è Configuraci√≥n de Validaciones (Insumo 1)</h1>

<p>
    Aqu√≠ puedes definir las <b>etiquetas</b> y <b>criterios de columnas</b> que usar√°n los filtros 
    para generar los valores en la columna <b>AN√ÅLISIS VALIDACIONES</b> del archivo maestro.
</p>

<!-- =============================
     Formulario din√°mico de reglas
============================== -->
<form action="{{ url_for('guardar_configuracion_general') }}" method="POST">
    <table>
        <thead>
            <tr>
                <th>Etiqueta / Resultado</th>
                <th>Criterio de Columna</th>
                <th>Valor esperado</th>
                <th>Acci√≥n</th>
            </tr>
        </thead>
        <tbody id="tabla-config">
            {% for regla in reglas %}
            <tr>
                <td><input type="text" name="etiquetas[]" value="{{ regla.etiqueta }}" required></td>
                <td><input type="text" name="columnas[]" value="{{ regla.columna }}" required></td>
                <td><input type="text" name="valores[]" value="{{ regla.valor }}" required></td>
                <td><button type="button" class="btn rojo" onclick="eliminarFila(this)">‚ùå</button></td>
            </tr>
            {% endfor %}

            {% if reglas|length == 0 %}
            <tr>
                <td><input type="text" name="etiquetas[]" placeholder="Ej: SIN ANTIVIRUS" required></td>
                <td><input type="text" name="columnas[]" placeholder="Ej: Antivirus" required></td>
                <td><input type="text" name="valores[]" placeholder="Ej: No instalado" required></td>
                <td><button type="button" class="btn rojo" onclick="eliminarFila(this)">‚ùå</button></td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    <!-- Botones -->
    <div style="margin-top: 15px; text-align: center;">
        <button type="button" class="btn amarillo" onclick="agregarFila()">‚ûï Agregar regla</button>
        <button type="submit" class="btn verde">üíæ Guardar configuraci√≥n</button>
        <a href="{{ url_for('index') }}" class="btn gris">üè† Volver al inicio</a>
    </div>
</form>

<!-- =============================
     Scripts din√°micos
============================== -->
<script>
function agregarFila() {
    let tbody = document.getElementById("tabla-config");
    let fila = document.createElement("tr");
    fila.innerHTML = `
        <td><input type="text" name="etiquetas[]" placeholder="Ej: SIN ANTIVIRUS" required></td>
        <td><input type="text" name="columnas[]" placeholder="Ej: Antivirus" required></td>
        <td><input type="text" name="valores[]" placeholder="Ej: No instalado" required></td>
        <td><button type="button" class="btn rojo" onclick="eliminarFila(this)">‚ùå</button></td>
    `;
    tbody.appendChild(fila);
}

function eliminarFila(boton) {
    let tbody = document.getElementById("tabla-config");
    if (tbody.rows.length > 1) {
        boton.closest("tr").remove();
    } else {
        alert("Debe existir al menos una regla configurada.");
    }
}
</script>
{% endblock %}
